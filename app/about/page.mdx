import { LightboxImage } from "@/components/lightbox-image";
import { LightboxVideo } from "@/components/lightbox-video";
import BlueSky from "@/components/svg/Bluesky";
import GitHub from "@/components/svg/GitHub";
import LinkedIn from "@/components/svg/LinkedIn";
import RaspberryPi from "@/components/svg/RaspberryPi";
import YouTube from "@/components/svg/YouTube";
import { RotatingGradientBorder } from "@/components/ui/RotatingGradientBorder";
import Link from "next/link";

import ImgFzfCmd from "@/public/images/fzf-cmd.jpg";
import ImgLogoProg from "@/public/images/Logo-Prog.jpg";
import ImgMeWithPups from "@/public/images/Me-With-Pups.jpeg";
import ImgMyPi from "@/public/images/My-Pi.jpeg";
import ImgTechForDummies from "@/public/images/Tech-For-Dummies.jpeg";
import ImgTechStack from "@/public/images/Tech-Stack.jpeg";
import ImgTheSetupOg from "@/public/images/The-Setup-OG.jpeg";
import ImgPi3D from "@/public/pi/pi.png";
import ImgPiDepth from "@/public/pi/pi_depth.png";

export const metadata = {
  title: "About",
  description:
    "Learn about Rio, this site, and the Raspberry Pi powering it all.",
};

export const aboutGallery = [
  {
    ...ImgMyPi,
    alt: "A Raspberry Pi",
    description: "The Raspberry Pi powering this site",
  },
  {
    ...ImgTechForDummies,
    alt: "Diagram showing how this website gets from my raspberry pi to your computer/phone",
    description: "The noob diagram (not to scale)",
  },
  {
    ...ImgTechStack,
    alt: "Diagram showing the tech stack powering this site",
    description: "The stack",
  },
  {
    ...ImgPi3D,
    alt: "A 3D model of a Raspberry Pi",
    description: "A 3D model of a Raspberry Pi",
  },
  {
    ...ImgPiDepth,
    alt: "A depth map of a Raspberry Pi",
    description: "A depth map of a Raspberry Pi",
  },
  {
    ...ImgFzfCmd,
    alt: "fzf-cmd",
    description: "fzf-cmd",
  },
  {
    ...ImgTheSetupOg,
    alt: "My Raspberry Pi setup",
    description: "The setup with laptop, pi, tv and Suki ‚òÅÔ∏è",
  },
  {
    type: "video",
    sources: [{ src: "/videos/DogBot-Demo.mp4", type: "video/mp4" }],
    description: "apparently hammers are not dogs... thanks DogBot!",
  },
  {
    ...ImgLogoProg,
    alt: "Logo progression",
    description: "Logo progression",
  },
];

<article className="prose container mx-auto max-w-2xl px-4 py-12">

<div className="not-prose mb-12 flex flex-col items-center text-center">
  <h1 className="text-3xl font-bold tracking-tight">Hey, I'm Rio üëã</h1>
  <Image
    priority
    placeholder="blur"
    src={ImgMeWithPups}
    alt="Rio with dogs"
    className="mb-6 max-w-96 shadow-lg"
  />
  <div className="mt-2 text-muted-foreground">
    Software developer and dog enthusiast based in Portland, OR.
  </div>
</div>

---

## What is this?

<div className="not-prose">
  <LightboxImage
    src={ImgMyPi}
    alt="A Raspberry Pi"
    caption="The Raspberry Pi powering this site"
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={0}
  />
</div>

Over the holidays, my sister gifted me a **Raspberry Pi** <RaspberryPi className="inline w-4 -mt-1" />. Thanks, sis! ü´∂

If you're unfamiliar, a Raspberry Pi is a credit-card-sized computer. Unlike traditional machines, it doesn't include a screen, keyboard, or even a case-just the bare essentials. The main selling point of my model? [It has a power button ü§Øü§Øü§Ø](https://www.raspberrypi.com/products/raspberry-pi-5/#:~:text=That%E2%80%99s%20not%20all-,Power%20button,-Dual%204Kp60).

So, why would you want one? Raspberry Pis are perfect for DIY projects. You can build robots, smart home devices, or even host your own website‚Äîlike I did.

After some late-night coding and falling down a few Linux rabbit holes, I launched my first **self-hosted website**.

Naturally, the theme is **dog photos**. Because dogs are awesome. üê∂

<div className="clear-both" />

---

## Inspiration

I've always leaned on services like Vercel and Netlify to host my projects. They're fast, reliable, and super easy to use.

But I've had this nagging curiosity to understand how the internet actually works. What's really happening behind the scenes? What does it take to manage a server?

So I challenged myself to dive into the world of self-hosting. It felt like the perfect opportunity to fill in some knowledge gaps‚Äîand get hands-on with my new Raspberry Pi.

Along the way, I learned a ton about networking, Linux, process management, Docker, DevOps, security, and more.

---

## Some background (for noobs)

<div className="not-prose">
  <LightboxImage
    src={ImgTechForDummies}
    alt="Diagram showing how this website gets from my raspberry pi to your computer/phone"
    caption="The noob diagram (not to scale)"
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={1}
  />
</div>

### Networking 101

The internet is basically just computers talking to each other over cables and Wi-Fi.

They exchange data using IP addresses, URLs, and something called DNS‚Äîoften referred to as the internet's "phone book."

For this project, I took my existing domain, `rioedwards.com`, and created a subdomain: `pi.rioedwards.com`, which I pointed to my Raspberry Pi. Now anyone can visit that subdomain and land on this site!

This is all facilitated by DNS providers (like [Cloudflare](https://www.cloudflare.com/)), who have servers all over the world for directing traffic. Your computer asks your router for `pi.rioedwards.com`, which eventually reaches Cloudflare, and they route the request to my Raspberry Pi.

### What is a server?

In simple terms, the internet has two types of computers: **clients** and **servers**. Your computer (the client) sends requests to mine (the server).

Your browser is your interface to the internet. It sends requests to servers and displays the responses.

My Pi runs a **web-server**, which allows it to respond to those requests. It responds with code (and images of dogs) which your browser uses to create the page you're seeing here.

### Tying it all together

To make this site work, I had to:

- Build the **frontend**‚Äîcode that runs in your browser
- Build the **backend**‚Äîcode that runs on my Pi
- Set up the domain and networking
- Figure out why my Pi kept disconnecting ü´†

There's more going on behind the scenes‚Äîlike a database, an AI-powered DogBot, and a system profiler‚Äîbut we'll get into that next..

### Bonus: What makes a computer a server?

Any computer can be a server‚Äîeven yours! All it takes is downloading some (free) server software like [nginx](https://nginx.org/) or [Apache](https://httpd.apache.org/) and turning it on.

To expose it to the internet, you'd need to configure your router or use a service like Cloudflare Tunnels, like I did. But be careful! If you make a mistake, you might break the whole internet and get in big trouble.

Want a deeper dive? Check out my article: [What is the Backend?](https://medium.com/@rioedwards/what-is-the-backend-ffd808ff950e).

---

## How it's made (for the nerds)

<div className="not-prose">
  <LightboxImage
    src={ImgTechStack}
    alt="Diagram showing the tech stack powering this site"
    caption="The stack"
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={2}
  />
</div>

### Tech Stack

| Layer           | Technology                                                                     |
| --------------- | ------------------------------------------------------------------------------ |
| OS              | Raspberry Pi OS (Debian GNU/Linux "trixie")                                    |
| Tunnel          | Cloudflare Tunnels                                                             |
| Web             | Next.js, React, TypeScript, Tailwind, ShadCN, Three.js, MDX, Drizzle, NextAuth |
| Database        | PostgreSQL                                                                     |
| AI Validation   | Python, FastAPI, OpenNSFW, PyTorch                                             |
| System Profiler | Hono, TypeScript, Node.js                                                      |

Was this overengineered? Probably. But my goal was to **learn**, not just ship.

### Phase 1

I started with [this tutorial](https://www.youtube.com/watch?v=Vp4glSVPT8o), which got me a basic fullstack [Next.js](https://nextjs.org/) app running on the Pi, with traffic routed through a [Cloudflare Tunnel](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/). That was an easy win, which gave me a lot of confidence to keep going.

At first, there was no database, authentication, or any of that fancy stuff. I was just kind of winging it and adding features as I went along.

I stored photos and metadata as raw files using Node.js. I also setup a simple UUID tagging system for identifying users and images.

I started building it over the holidays and had it connected to the TV, so my family could upload dog photos and see them on screen.

<div className="not-prose">
  <LightboxImage
    src={ImgTheSetupOg}
    alt="My Raspberry Pi setup"
    caption={
      <div>
        Laptop, Pi, TV and{" "}
        <Link
          href="https://www.instagram.com/suki.thesammy/"
          className="text-primary"
          target="_blank"
        >
          Suki ‚òÅÔ∏è
        </Link>
      </div>
    }
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={3}
  />
</div>

Eventually, work got busy, and the project went on the back burner for about a year.

Highlights from Phase 1:

- <span className="inline">
    I built this component that wraps anything in a
  </span>
  <RotatingGradientBorder
    backgroundColor="transparent"
    borderRadius="12px"
    containerClassName="mx-1 inline-block align-middle bg-background"
  >
    <span className="rounded-full bg-background px-2">
      Glowing Gradient Border
    </span>
  </RotatingGradientBorder>
  <span className="inline">
    {". "}Might release it as an npm package someday.
  </span>
- I wrote a Bash script for auto-updating the app and restarting the server. This was my first step into DevOps for this project.

- I built a browser-based image compression/conversion service to deal with large images and the HEIC file format, which is the default for iPhone images. As it turns out, there's essentially [no browser support for them ü§î](https://caniuse.com/?search=heif).

### Phase 2

After a long break, I came back with a fresh perspective and lots of ideas. First step: upgrade the stack.

Improvements:

- Switched to [SQLite](https://sqlite.org/) and [Prisma](https://www.prisma.io/)
- Added [NextAuth](https://next-auth.js.org/) for authentication
- Identified key issues:
  1. Server instability
  2. Clunky deployments
  3. No image moderation

To fix the issues, I:

1. Replaced `nohup` with [**PM2**](https://pm2.keymetrics.io/) for process management
2. Set up a [**GitHub Actions**](https://docs.github.com/en/actions) workflow for CI/CD
3. Created **DogBot**, an AI image validator
4. [**Dockerized**](https://www.docker.com/) everything
5. Rebuilt the `/stats` page as a dedicated microservice

#### DogBot - AI Image Validation

DogBot runs as a middleware service, which verifies that all uploaded images are "SFW" and contain dogs.

Built using:

- [**OpenNSFW**](https://github.com/bhky/opennsfw2?tab=readme-ov-file) for detecting inappropriate content
- [**PyTorch/TorchVision**](https://docs.pytorch.org/vision/stable/index.html) for verifying images contain dogs

It runs on a [**FastAPI**](https://fastapi.tiangolo.com/) server, processing images and returning `isDog` and `isNSFW` scores as weights and booleans.

<LightboxVideo
  src="/videos/DogBot-Demo.mp4#t=0.001"
  caption="apparently hammers are not dogs... thanks DogBot!"
  className="w-full rounded-lg"
  gallery={aboutGallery}
  galleryIndex={4}
  enableLightbox
/>

#### Docker Woes & Wins

Docker makes things easier, but only if you know what you're doing üòÖ.

I spent more time learning Docker/Docker Compose than anything else in this project. It was worth it though. I learned a lot, and the process even inspired a [side project](https://github.com/rioedwards/fz-cmd): a CLI utility for quickly casting commands from your history.

<div className="not-prose">
  <LightboxImage
    src={ImgFzfCmd}
    alt="fz-cmd"
    caption={
      <div>
        <Link
          href="https://github.com/rioedwards/fz-cmd"
          className="text-primary"
          target="_blank"
        >
          fz-cmd
        </Link>
        , built with{" "}
        <Link
          href="https://www.gnu.org/software/bash/"
          className="text-primary"
          target="_blank"
        >
          bash
        </Link>
        {", "}
        <Link
          href="https://github.com/junegunn/fzf"
          className="text-primary"
          target="_blank"
        >
          fzf
        </Link>
        {", "}
        <Link href="https://atuin.sh/" className="text-primary" target="_blank">
          atuin
        </Link>
        {" and "}
        <Link
          href="https://github.com/tealdeer-rs/tealdeer"
          className="text-primary"
          target="_blank"
        >
          tealdeer
        </Link>
      </div>
    }
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={5}
  />
</div>

### Phase 3

Along the way, I discovered this tutorial from Lee Rob on [self-hosting Next.js apps](https://www.youtube.com/watch?v=sIVL4JMqRfc) which was a great resource. I followed it closely, and once I had it working, I rebuilt my app using his setup, reintegrating my features one by one.

Upgrades:

- Prisma ‚û°Ô∏è [Drizzle](https://orm.drizzle.team/)
- SQLite ‚û°Ô∏è [PostgreSQL](https://www.postgresql.org/)
- Added [**Nginx**](https://nginx.org/) for image caching

#### System Profiler Service

This started as a simple `/stats` page, but eventually evolved into a fully-fledged system-profiler, with a dashboard for monitoring the health of the host server and all the containers in real-time.

- Built using **Hono**, **TypeScript**, and **Node.js**
- Gathers metrics from the host's filesystem (`/proc`, `/sys`) and Docker socket
- Fetched from the Next.js backend and streamed to the frontend via **Server-Sent Events (SSE)**.
- All requests are authenticated with a token to keep it secure.
- The dashboard uses [ReCharts](https://recharts.github.io/)

#### 3D Model using a Depth Map

This was inspired by a [video by Wes Bos & SyntaxFM](https://www.youtube.com/watch?v=HzL65tTeANs&t=70s).

I created a 3D depth map using a combination of [MiDaS](https://github.com/isl-org/MiDaS), [Dalle-3](https://openai.com/dall-e-3/) and Figma. MiDaS generated the original depth map, then Dalle-3 made a more textured version which I composited with the MiDaS image. Then I touched them up in [Figma](https://www.figma.com/) and exported the result as a PNG. Finally, they get fed into [Three.js](https://threejs.org/) to create the 3D effect.

I wrote a helper script for generating these depth maps and viewing the results in realtime. It's in my commit history if you're interested (e721cbe).

It works by using the lightness of the pixels in the depth map to determine how much the corresponding pixels in the source image are displaced when rotated.

<div className="not-prose flex flex-col gap-4 md:flex-row">
  <LightboxImage
    src={ImgPi3D}
    alt="2D image of a Raspberry Pi"
    caption="2D image of a Raspberry Pi"
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={6}
  />
  <LightboxImage
    src={ImgPiDepth}
    alt="Depth map generated using MiDaS"
    caption="Depth map of the Raspberry Pi image"
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={7}
  />
</div>

### Phase 4

At this point, it was ‚Äúfeature-complete.‚Äù So naturally, I added more features. ü§∑‚Äç‚ôÇÔ∏è

#### MDX Support

This was my first time using [MDX](https://mdxjs.com/), and I'm in love! I can write markdown and still embed React components.

#### Yet Another React Lightbox

I used [Yet Another React Lightbox](https://yet-another-react-lightbox.com/) for the fullscreen image and video previews. It's great!

#### The Logo

As with most of my projects, I designed the DogTown logo using Figma. I love giving my projects some personality.

<div className="not-prose">
  <LightboxImage
    src={ImgLogoProg}
    alt="Logo progression"
    caption="Logo progression"
    enableLightbox
    gallery={aboutGallery}
    galleryIndex={8}
  />
</div>

#### I almost forgot

I didn't mention much about core tech like React, Next.js, Tailwind, and ShadCN. I use them on the daily so I didn't feel the need to talk about them.

There is one new technique I found for building UI's. [V0](https://v0.dev/)! I used it to generate a dog-themed UI component library and cherry-picked design ideas.

---

## Final Thoughts

I learned a lot from this project. I deepened my knowlege of Docker, DevOps, Linux, bash scripting, networking and more. And these are skills that I'll benefit from for the rest of my career. Unless AI takes over... ü§î

Okay, now now that I mentioned it, I feel like I have to share my perspective on AI... I'll keep it brief:

> I can't imagine a world where knowledge, skills, and experience aren't valuable.

That's all. Thanks for reading! ‚ù§Ô∏è

---

## Get in Touch

Feel free to reach out if you have questions, feedback, or just want to chat!

<div className="not-prose mt-6 flex gap-4">
  <Link href="https://www.linkedin.com/in/rio-edwards/" aria-label="LinkedIn">
    <LinkedIn className="w-8 text-foreground/70 transition-colors hover:text-foreground" />
  </Link>
  <Link
    href="https://bsky.app/profile/rioedwards.bsky.social"
    aria-label="Bluesky"
  >
    <BlueSky className="w-8 text-foreground/70 transition-colors hover:text-foreground" />
  </Link>
  <Link
    href="https://www.youtube.com/channel/UCZdVYjS_Os_4e7DZAZSRxBQ"
    aria-label="YouTube"
  >
    <YouTube className="w-8 text-foreground/70 transition-colors hover:text-foreground" />
  </Link>
  <Link href="https://github.com/rioedwards/" aria-label="GitHub">
    <GitHub className="w-8 text-foreground/70 transition-colors hover:text-foreground" />
  </Link>
</div>

</article>
